# 在服务器上搭建 Git

演示在 Linux 服务器上进行一次基本且简化的安装所需要的命令和步骤

在假设 Git 服务器之前，需要把现有仓库导出为裸仓库，即一个不包含当前工作目录的仓库。

`git clone --bare myproject myproject.git`
现在，my_project.git 目录中应该有 Git 目录的副本了。
整体的效果相当于
`cp -Rf myproject/.git my_project.git`

取出 Git 仓库自身，不要工作没有了，然后单独为它创建一个目录

## 把裸仓库放到服务器上
假设一个域名为 git.example.com 的服务器已经假设好，并且可以通过 SSH 连接，想要把所有的 Git 仓库放在 /srv/git 目录下
假设服务器存在 /srv/git 目录，通过以下命令可以复制裸仓库创建一个新仓库
`scp -r my_project.git user@git.example.com:/srv/git`

此时，其他可通过 SSH 连接到一个服务器，并且对 /srv/git/my_project.git 目录拥有可写权限，那么它也将自动拥有推送权限。

如果到该项目目录中运行 `git init` 命令，并加上 --shared 选项，那么 Git 会自动修改仓库目录的组权限为可写。注意，运行此命令的工程不会摧毁任何提交，引用等内容。

```
ssh user@git.example.com
cd /srv/git/my_project.git
git init --bare --shared
```

至此，根据现有的 Git 仓库创建一个裸仓库，然后把它放到协作者都有 SSH 访问权的服务器上的任务就完成了。

当然以上的操作完成后，只要在服务器上加入可以用 SSH 登录的账号，然后把裸仓库放到大家都有读写权限的地方，这样有账号的人就可以访问该 Git 仓库了。
但是以上的仓库只能和几个人在一个私有项目上合作。

## 小型安装
架设 Git 服务最复杂的地方就在于用户管理，如果需要仓库对特定的用户刻度，而给另一部分用户读写权限，那么访问和许可安排就会比较困难。

### SSH 安装

如果团队里的每个人都对仓库有读写全写，又不能给每个人在服务器上建立账户，那么提供 SSH 连接 就是唯一的选择了，假设用来共享仓库的服务器已经安装了 SSH 服务，而且用户就通过它访问服务器。

在主机上建立一个 'git' 账户，然后给每个需要读写权限的人发送一个 SSH 权限，然后将其加入 Git 账户的 ~/.ssh/authorized_keys 文件，这样每个人都可以通过 'git' 账户访问主机。这样也不会影响提交的数据，访问主机用的身份不会影响提交对象的提交信息。

还有一个办法是让 SSH 服务器通过某个 LDAP 服务，或者其他已经设定好的集中授权机制来进行授权。只要每个用户可以获得主机的 shell 访问权限，任何 SSH 授权机制都可以被视为有效。
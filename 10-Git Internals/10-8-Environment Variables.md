# 环境变量

Git 总是在一个 bash shell 中运行，并借助一些 shell 环境变量来决定它的运行方式。 有时候，知道它们是什么以及它们如何让 Git 按照你想要的方式去运行会很有用。 这里不会列出所有的 Git 环境变量，但我们会涉及最有用的那部分。

## 全局行为

像通常的程序一样，Git 的常规行为依赖于环境变量。

| 变量                 | 作用                                                            | 备注                                                                                                          |
| -------------------- | --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| GIT_EXEC_PATH        | 决定 Git 到哪找它的子程序 （像 git-commit, git-diff 等等）      | 可以用 git --exec                                                                                             |
| -path 来查看当前设置 |
| HOME                 | 这是 Git 查找全局配置文件的地方                                 | 通常不修改，如果你想要一个包括全局配置的真正的便携版 Git， 你可以在便携版 Git 的 shell 配置中覆盖 HOME 设置。 |
| PREFIX               | Git 编译时使用的路径                                            | Git 在 $PREFIX/etc/gitconfig 查找此文件                                                                       |
| GIT_CONFIG_NOSYSTEM  | 就禁用系统级别的配置文件                                        | 这在系统配置影响了你的命令，而你又无权限修改的时候很有用。                                                    |
| GIT_PAGER            | 控制在命令行上显示多页输出的程序                                | 如果这个没有设置，就会用 PAGER                                                                                |
| GIT_EDITOR           | 当用户需要编辑一些文本（比如提交信息）时， Git 会启动这个编辑器 | 如果没设置，就会用EDITOR                                                                                      |

## 版本库位置

Git 用了几个变量来确定它如何与当前版本库交互。

| 变量                             | 作用                                                                                                              | 备注                                                                                                                              |
| -------------------------------- | ----------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| GIT_DIR                          | 是 .git 目录的位置                                                                                                | 如果这个没有设置， Git 会按照目录树逐层向上查找 .git 目录，直到到达 ~ 或 /。                                                      |
| GIT_CEILING_DIRECTORIES          | 控制查找 .git 目录的行为                                                                                          | 如果你访问加载很慢的目录（如那些磁带机上的或通过网络连接访问的），你可能会想让 Git 早点停止尝试，尤其是 shell 构建时调用了 Git 。 |
| GIT_WORK_TREE                    | 是非空版本库的工作目录的根路径                                                                                    | 如果指定了 --git-dir 或 GIT_DIR 但未指定 --work -tree、GIT_WORK_TREE 或 core.worktree，那么当前工作目录就会视作工作树的顶级目录。 |
| GIT_INDEX_FILE                   | 是索引文件的路径（只有非空版本库有）                                                                              |                                                                                                                                   |
| GIT_OBJECT_DIRECTORY             | 用来指定 .git/objects 目录的位置                                                                                  |                                                                                                                                   |
| GIT_ALTERNATE_OBJECT_DIRECTORIES | 一个冒号分割的列表（格式类似 /dir/one:/dir/two:…）用来告诉 Git 到哪里去找不在 GIT_OBJECT_DIRECTORY 目录中的对象。 | 如果你有很多项目有相同内容的大文件，这                                                                                            |
| 个可以用来避免存储过多备份。     |

## 路径规则

所谓 “pathspec” 是指你在 Git 中如何指定路径，包括通配符的使用。 它们会在 .gitignore 文件中用到，
命令行里也会用到（git add *.c）。

| 变量                                    | 作用                             | 备注                                                                                                                                                                                                                                                                              |
| --------------------------------------- | -------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GIT_GLOB_PATHSPECS/GIT_NOGLOB_PATHSPECS | 控制通配符在路径规则中的默认行为 | 如果GIT_GLOB_PATHSPECS 设置为 1, 通配符表现为通配符（这是默认设置）; 如果 GIT_NOGLOB_PATHSPECS 设置为 1,通配符仅匹配字面。意思是 *.c 只会匹配 文件名是 “*.c” 的文件，而不是以 .c 结尾的文件。 你可以在各个路径规范中用 :(glob) 或 :(literal) 开头来覆盖这个配置，如 :(glob)*.c 。 |
| GIT_LITERAL_PATHSPECS                   | 禁用上面的两种行为；             | 通配符将不能用，前缀覆盖也不能用。                                                                                                                                                                                                                                                |
| GIT_ICASE_PATHSPECS                     | 让所有的路径规范忽略大小写。     |                                                                                                                                                                                                                                                                                   |

## 提交

Git 提交对象的创建通常最后是由 git-commit-tree 来完成， git-commit-tree 用这些环境变量作主要的信息源。 仅当这些值不存在才回退到预置的值。

| 变量                | 作用                         | 备注 |
| ------------------- | ---------------------------- | ---- |
| GIT_AUTHOR_NAME     | 是 “author” 字段的可读名字。 |      |
| GIT_AUTHOR_EMAIL    | “author” 字段的邮件          |      |
| GIT_AUTHOR_DATE     | “author” 字段的时间戳        |      |
| GIT_COMMITTER_NAME  | “committer” 字段的可读名字   |      |
| GIT_COMMITTER_EMAIL | “committer” 字段的邮件       |      |
| GIT_COMMITTER_DATE  | “committer” 字段的时间戳     |      |

如果 user.email 没有配置， 就会用到 EMAIL 指定的邮件地址。 如果 这个 也没有设置， Git 继续回退使用系统用户和主机名。

## 网络

| 变量                                             | 作用                                                                                                                          | 备注                                                                                                                            |
| ------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| GIT_CURL_VERBOSE                                 | 告诉 Git 显示所有由那个库产生的消息。 这跟在命令行执行 curl -v 差不多。                                                       |                                                                                                                                 |
| GIT_SSL_NO_VERIFY                                | 告诉 Git 不用验证 SSL 证书                                                                                                    | 这在有些时候是需要的， 例如你用一个自己签名的证书通过 HTTPS 来提供 Git 服务， 或者你正在搭建 Git 服务器，还没有安装完全的证书。 |
| GIT_HTTP_LOW_SPEED_LIMIT/GIT_HTTP_LOW_SPEED_TIME | 如果 Git 操作在网速低于 GIT_HTTP_LOW_SPEED_LIMIT 字节／秒，并且持续 GIT_HTTP_LOW_SPEED_TIME秒以上的时间，Git 会终止那个操作。 | 这些值会覆盖 http.lowSpeedLimit 和 http.lowSpeedTime 配置的值                                                                   |
| GIT_HTTP_USER_AGENT                              | 设置 Git 在通过 HTTP 通讯时用到的 user-agent                                                                                  | 默认值类似于 git/2.0.0                                                                                                          |

## 比较和合并

| 变量                                      | 作用                                                                            | 备注                                                                                                                                                                                       |
| ----------------------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| GIT_DIFF_OPTS                             | 有效值仅支持 -u<n> 或 --unified=<n>，用来控制在 git diff 命令中显示的内容行数。 | 这个有点起错名字了                                                                                                                                                                         |
| GIT_EXTERNAL_DIFF                         | 用来覆盖 diff.external 配置的值                                                 | 如果设置了这个值， 当执行 git diff 时，Git会调用该程序。                                                                                                                                   |
| GIT_DIFF_PATH_COUNTER/GIT_DIFF_PATH_TOTAL | 对于 GIT_EXTERNAL_DIFF 或 diff.external 指定的程序有用。                        | 前者表示在一系列文件中哪个是被比较的（从 1 开始），后者表示每批文件的总数。                                                                                                                |
| GIT_MERGE_VERBOSITY                       | 控制递归合并策略的输出                                                          | 允许的值有下面这些： 0 什么都不输出，除了可能会有一个错误信息。 1 只显示冲突。 2 还显示文件改变。 3 显示因为没有改变被跳过的文件。 4 显示处理的所有路径。 5 显示详细的调试信息。默认值是 2 |

## 调试

想 真正地 知道 Git 正在做什么? Git 内置了相当完整的跟踪信息，你需要做的就是把它们打开。 这些变量的可用值如下：
+ “true”，“1”，“2”： 跟踪类别写到标准错误输出
+  以 / 开头的绝对路径——跟踪输出会被写到那个文件。

| 变量                  | 作用                                      | 备注                                               |
| --------------------- | ----------------------------------------- | -------------------------------------------------- |
| GIT_TRACE             | 控制常规跟踪，它并不适用于特殊情况        | 它跟踪的范围包括别名的展开和其他子程序的委托       |
| GIT_TRACE_PACK_ACCESS | 控制访问打包文件的跟踪信息                | 第一个字段是被访问的打包文件，第二个是文件的偏移量 |
| GIT_TRACE_PACKET      | 打开网络操作包级别的跟踪信息              |                                                    |
| GIT_TRACE_PERFORMANCE | 控制性能数据的日志打印                    | 输出显示了每个 git 命令调用花费的时间。            |
| GIT_TRACE_SETUP       | 显示 Git 发现的关于版本库和交互环境的信息 |                                                    |

### 示例
`GIT_TRACE=true git lga`
`GIT_TRACE_PACK_ACCESS=true git status`
`GIT_TRACE_PACKET=true git ls-remote origin`
`GIT_TRACE_PERFORMANCE=true git gc`

## 其它

| 变量              | 作用                                                    | 备注                                                                                                                                                                                                                             |
| ----------------- | ------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| GIT_SSH           | Git 连接 SSH 主机时会用指定的程序代替 ssh               | 它会被用 `$GIT_SSH [username@]host [-p <port>] <command>` 的命令式调用。 这不是配置定制 ssh 调用方式的最简单的452方法; 它不支持额外的命令行参数， 所以你必须写一个封装脚本然后让 GIT_SSH 指向它。 可能用~/.ssh/config 会更简单。 |
| GIT_ASKPASS       | 覆盖了 core.askpass 配置                                | 这是 Git 需要向用户请求验证时用到的程序，它接受一个文本提示作为命令行参数，并在 stdout 中返回应答。                                                                                                                              |
| GIT_NAMESPACE     | 控制有命令空间的引用的访问，与 --namespace 标志是相同的 | 这主要在服务器端有用，如果你想在一个版本库中存储单个版本库的多个 fork, 只要保持引用是隔离的就可以                                                                                                                                |
| GIT_FLUSH         | 强制 Git 在向标准输出增量写入时使用没有缓存的 I/O       | 设置为 1 让 Git 刷新更多， 设置为 0 则使所有的输出被缓存。 默认值（若此变量未设置）是根据活动和输出模式的不同选择合适的缓存方案。                                                                                                |
| GIT_REFLOG_ACTION | 让你可以指定描述性的文字写到 reflog 中                  |                                                                                                                                                                                                                                  |

` GIT_REFLOG_ACTION="my action" git commit --allow-empty -m 'my message'`
